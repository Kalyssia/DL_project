<!DOCTYPE html>
<html>
<head>
	<title>Doodle Classifier</title>
	<style>
		body {
			display: flex;
			flex-direction: column;
			align-items: center;
			font-family: sans-serif;
			background-color: #f9f9f9;
		}
		canvas {
			border: 1px solid black;
			background-color: white;
			margin-bottom: 10px;
			touch-action: none;
		}
		button {
			margin: 5px;
			padding: 8px 12px;
			font-size: 16px;
		}
		#result {
			font-size: 20px;
			margin-top: 10px;
		}
	</style>
</head>
<body>
	<h1>Draw your Doodle</h1>
	<canvas id="canvas" width="560" height="560"></canvas>
	<div>
		<button onclick="clearCanvas()">Clear</button>
	</div>
	<p id="result"></p>

	<script>
		const canvas = document.getElementById("canvas");
		const ctx = canvas.getContext("2d");
		let drawing = false;
		let lastX = 0, lastY = 0;

		canvas.addEventListener("mousedown", (e) => {
			drawing = true;
			[lastX, lastY] = [e.offsetX, e.offsetY];
		});

		canvas.addEventListener("mouseup", () => {
			drawing = false;
			send();
		});

		canvas.addEventListener("mouseout", () => drawing = false);

		canvas.addEventListener("mousemove", draw);

		function draw(e) {
			if (!drawing) return;
			ctx.strokeStyle = "black";
			ctx.lineWidth = 10;
			ctx.lineCap = "round";
			ctx.beginPath();
			ctx.moveTo(lastX, lastY);
			ctx.lineTo(e.offsetX, e.offsetY);
			ctx.stroke();
			[lastX, lastY] = [e.offsetX, e.offsetY];
		}

		function clearCanvas() {
			ctx.clearRect(0, 0, canvas.width, canvas.height);
			ctx.fillStyle = "white";
			ctx.fillRect(0, 0, canvas.width, canvas.height);
			document.getElementById("result").innerText = "";
		}

		function send() {
			const image = canvas.toDataURL("image/png");
			fetch("/predict", {
				method: "POST",
				headers: { "Content-Type": "application/json" },
				body: JSON.stringify({ image })
			})
			.then(res => res.json())
			.then(data => {
				document.getElementById("result").innerText = "Pr√©diction : " + data.prediction;
			});
		}

		clearCanvas();
	</script>
</body>
</html>
